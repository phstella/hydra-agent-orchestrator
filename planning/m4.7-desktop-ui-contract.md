# M4.7 Desktop UI Contract

Last updated: 2026-02-25

## 1. Purpose

Define an explicit desktop-first UI/UX contract for `M4.7` cockpit convergence.
This avoids ambiguity across implementation agents and keeps behavior aligned
with the target mock direction.

## 2. Target Viewports

1. Primary: `>= 1280px` width.
2. Minimum in scope: `>= 1024px` width.
3. Out of scope for this milestone: `< 1024px` optimization and touch-first UX.

## 3. Layout Contract

At `>= 1280px`:
1. Left utility rail is always visible.
2. Center workspace is dominant content region.
3. Right leaderboard rail is always visible.
4. Top status strip remains pinned to cockpit shell.

At `1024px - 1279px`:
1. Left rail stays visible in compact form.
2. Right rail remains available with reduced card density.
3. Center workspace keeps race config + live terminal + intervention controls.

## 4. Information Architecture Contract

Cockpit default route must expose:
1. Race configuration and launch controls.
2. Live agent leaderboard with selection state.
3. Focused terminal stream bound to selected agent.
4. Inline intervention controls (send input + stop/interrupt).
5. Completion summary with explicit transition to review pane.

Legacy tabs can remain as fallback/debug paths but must not be required to
complete the primary loop.

## 5. Interaction Contract

1. Agent card selection updates focused terminal stream within one polling cycle.
2. Terminal auto-scroll follows output while user is at tail.
3. Manual scroll-up suspends forced auto-scroll until user returns to tail.
4. Send-input only enabled for selected running agent.
5. Stop/interrupt only enabled for selected running agent.
6. Session/race terminal states must show explicit end-state label:
   `completed`, `failed`, `stopped`, or `timed_out`.

## 6. Error Surface Contract

For launch/stream/parse/timeout failures:
1. Show compact status in right leaderboard card.
2. Show matching context in terminal header/panel state.
3. Include one actionable next-step hint (retry, check adapter, open review, etc.).

No silent failures and no UI dead-end requiring app restart for transient errors.

## 7. Design System Contract

1. New UI must use existing tokenized components and variables.
2. No hardcoded hex values in new/modified cockpit components.
3. Color direction for cockpit remains dark/green base with marine-blue highlights.
4. Typography and spacing should follow existing design-system primitives.

## 8. Validation Contract

Minimum required smoke checks:
1. Cockpit shell render (left/top/center/right regions).
2. Race start from cockpit center.
3. Leaderboard status updates during run.
4. Focus switch updates terminal source.
5. Input send success path.
6. Input send failure path.
7. Stop/interrupt lifecycle transition.
8. Completion summary and review transition CTA.

Required command set:
1. `cargo test --workspace --locked --offline`
2. `cargo clippy --workspace --all-targets --locked --offline -- -D warnings`
3. `npm run lint` (frontend)
4. `npm run test:smoke` (frontend)

## 9. Related Files

1. `planning/m4.7-local-execution-pack.md`
2. `planning/p4-race-cockpit-convergence-implementation-guide.md`
3. `instructions/phase-4.md`
